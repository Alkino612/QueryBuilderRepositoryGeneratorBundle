<?php

/**
 * File generated by the QueryBuilderRepositoryGeneratorBundle
 * DO NOT MODIFY IT, CHANGES WOULD BE OVERWRITTEN
 *
 */

namespace tbn\QueryBuilderRepositoryGeneratorBundle\{{ bundleName }}\Repository;


use Doctrine\ORM\Query\Expr\Comparison;
use Doctrine\ORM\QueryBuilder;

class {{ tableName }}Repository extends {{ extendClass }}
{
    protected static $parameterIndex = 0;

    /**
     * Get a new parameter index
     *
     * @return integer The index
     */
    public static function getParameterIndex()
    {
        self::$parameterIndex++;

        return self::$parameterIndex;
    }

    /**
     * Get a new query builder
     *
     * @return integer The index
     */
    public function getNewQueryBuilder()
    {
        $qb = $this->createQueryBuilder('{{ entityDql }}');

        return $qb;
    }

    /**
     * Get the result of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getResult();

         return $results;
    }

    /**
     * Get the SingleResult of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderSingleResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getSingleResult();

         return $results;
    }

    /**
     * Get the OneOrNullResult of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderOneOrNullResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getOneOrNullResult();

         return $results;
    }

    /**
     * Get the getArrayResult of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderArrayResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getArrayResult();

         return $results;
    }

    /**
     * Get the ScalarResult of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderScalarResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getScalarResult();

         return $results;
    }

    /**
     * Get the SingleScalarResult of the query builder
     *
     * @return unknown The results
     */
    public static function getQueryBuilderSingleScalarResult(QueryBuilder $qb)
    {
         $query = $qb->getQuery();
         $results = $query->getSingleScalarResult();

         return $results;
    }

    /**
     * Does this entity exists in database
     * It guess that the entity has an ID property has identifier
     *
     * @param DoctrineEntity $entity
     * @return boolean The entity exists
     */
    public function exists($entity)
    {
        if (null === $entity) {
            throw new \Exception('The entity parameter must be provided, it can not be null');
        }

        $exists = false;

        $qb = $this->getNewQueryBuilder();
        $entityId = $entity->getId();
        self::filterById($qb, $entityId);

        $result = self::getQueryBuilderOneOrNullResult($qb);

        if (null !==  $result) {
            //the entity was found
            $exists = true;
        }

        return $exists;
    }

    /**
     * Get a new delete query builder
     * @return QueryBuilder
     */
    public function getDeleteQueryBuilder()
    {
        $qb = $this->_em->createQueryBuilder();
        $qb->delete($this->_entityName, '{{ entityDql }}');

        return $qb;
    }

